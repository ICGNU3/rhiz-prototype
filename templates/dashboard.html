{% extends "base.html" %}

{% block title %}Dashboard - Rhiz{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Unified Dashboard Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h3 mb-2">Rhiz Intelligence Dashboard</h1>
                        <p class="text-muted mb-0">Unified relationship intelligence platform</p>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary btn-sm" onclick="showQuickAction('goal')">
                            <i class="bi bi-plus"></i> Quick Goal
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="showQuickAction('contact')">
                            <i class="bi bi-person-plus"></i> Quick Contact
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-3">
                <ul class="nav nav-pills nav-fill" id="dashboardTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab">
                            <i class="bi bi-speedometer2"></i> Overview
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="goals-tab" data-bs-toggle="pill" data-bs-target="#goals" type="button" role="tab">
                            <i class="bi bi-target"></i> Goals
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="contacts-tab" data-bs-toggle="pill" data-bs-target="#contacts" type="button" role="tab">
                            <i class="bi bi-people"></i> Contacts
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="intelligence-tab" data-bs-toggle="pill" data-bs-target="#intelligence" type="button" role="tab">
                            <i class="bi bi-brain"></i> Intelligence
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="network-tab" data-bs-toggle="pill" data-bs-target="#network" type="button" role="tab">
                            <i class="bi bi-diagram-3"></i> Network
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="dashboardTabContent">
        
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="glass-card p-3 text-center">
                        <div class="h4 text-primary mb-1">{{ stats.total_goals or 0 }}</div>
                        <div class="small text-muted">Active Goals</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="glass-card p-3 text-center">
                        <div class="h4 text-success mb-1">{{ stats.total_contacts or 0 }}</div>
                        <div class="small text-muted">Total Contacts</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="glass-card p-3 text-center">
                        <div class="h4 text-warning mb-1">{{ stats.pending_follow_ups or 0 }}</div>
                        <div class="small text-muted">Follow-ups Due</div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="glass-card p-3 text-center">
                        <div class="h4 text-info mb-1">{{ stats.this_month_interactions or 0 }}</div>
                        <div class="small text-muted">This Month</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="glass-card p-4">
                        <h6 class="mb-3">Recent Activity</h6>
                        {% if recent_interactions and recent_interactions|length > 0 %}
                            {% for interaction in recent_interactions[:5] %}
                            <div class="d-flex align-items-center p-2 mb-2 bg-dark bg-opacity-25 rounded">
                                <div class="flex-grow-1">
                                    <div class="small fw-medium">{{ interaction.interaction_type.replace('_', ' ').title() }}</div>
                                    <div class="text-muted small">{{ interaction.notes[:50] }}{% if interaction.notes and interaction.notes|length > 50 %}...{% endif %}</div>
                                </div>
                                <div class="small text-muted">
                                    {{ interaction.created_at.strftime('%m/%d') if interaction.created_at else 'Recent' }}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-3">
                                <i class="bi bi-activity text-muted"></i>
                                <p class="text-muted small mt-2">No recent activity</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="col-lg-6 mb-4">
                    <div class="glass-card p-4">
                        <h6 class="mb-3">AI Insights</h6>
                        {% if ai_suggestions and ai_suggestions|length > 0 %}
                            {% for suggestion in ai_suggestions[:3] %}
                            <div class="p-3 mb-2 bg-dark bg-opacity-25 rounded">
                                <div class="small text-primary mb-1">{{ suggestion.suggestion_type.replace('_', ' ').title() }}</div>
                                <div class="small">{{ suggestion.content[:80] }}{% if suggestion.content|length > 80 %}...{% endif %}</div>
                                {% if suggestion.confidence_score %}
                                <div class="mt-2">
                                    <div class="small text-muted">Confidence: {{ "%.0f" | format(suggestion.confidence_score * 100) }}%</div>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-3">
                                <i class="bi bi-lightbulb text-muted"></i>
                                <p class="text-muted small mt-2">No AI suggestions yet</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Tab -->
        <div class="tab-pane fade" id="goals" role="tabpanel">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0">Goal Management</h5>
                    <a href="/goals" class="btn btn-primary btn-sm">Manage All Goals</a>
                </div>
                
                {% if goals and goals|length > 0 %}
                    <div class="row">
                        {% for goal in goals %}
                        <div class="col-md-6 mb-3">
                            <div class="p-3 bg-dark bg-opacity-25 rounded">
                                <div class="fw-medium mb-2">{{ goal.description[:100] }}{% if goal.description|length > 100 %}...{% endif %}</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> {{ goal.created_at.strftime('%B %d, %Y') if goal.created_at else 'Recent' }}
                                    </small>
                                    <a href="/goals/{{ goal.id }}" class="btn btn-outline-primary btn-sm">View</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-target display-4 text-muted"></i>
                        <h6 class="mt-3">No Goals Yet</h6>
                        <p class="text-muted">Create your first goal to start building meaningful connections</p>
                        <a href="/goals/create" class="btn btn-primary">Create Your First Goal</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Contacts Tab -->
        <div class="tab-pane fade" id="contacts" role="tabpanel">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0">Contact Management</h5>
                    <div class="d-flex gap-2">
                        <a href="/contacts/import" class="btn btn-outline-secondary btn-sm">Import</a>
                        <a href="/contacts" class="btn btn-primary btn-sm">Manage All Contacts</a>
                    </div>
                </div>
                
                {% if contacts and contacts|length > 0 %}
                    <div class="row">
                        {% for contact in contacts %}
                        <div class="col-md-6 mb-3">
                            <div class="d-flex align-items-center p-3 bg-dark bg-opacity-25 rounded">
                                <div class="flex-grow-1">
                                    <div class="fw-medium">{{ contact.name }}</div>
                                    <div class="small text-muted">
                                        {% if contact.company %}{{ contact.company }}{% endif %}
                                        {% if contact.title %} · {{ contact.title }}{% endif %}
                                    </div>
                                    {% if contact.email %}
                                    <div class="small text-muted">{{ contact.email }}</div>
                                    {% endif %}
                                </div>
                                <div class="text-end">
                                    {% if contact.warmth %}
                                    <span class="badge bg-{{ 'success' if contact.warmth == 'warm' else 'warning' if contact.warmth == 'cool' else 'secondary' }} mb-2">
                                        {{ contact.warmth.title() }}
                                    </span>
                                    {% endif %}
                                    <div>
                                        <a href="/contacts/{{ contact.id }}" class="btn btn-outline-primary btn-sm">View</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-people display-4 text-muted"></i>
                        <h6 class="mt-3">No Contacts Yet</h6>
                        <p class="text-muted">Add your first contact to start building your network</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="/contacts/create" class="btn btn-primary">Add Contact</a>
                            <a href="/contacts/import" class="btn btn-outline-primary">Import Contacts</a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Intelligence Tab -->
        <div class="tab-pane fade" id="intelligence" role="tabpanel">
            <div class="glass-card p-4">
                <h5 class="mb-4">AI-Powered Intelligence</h5>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="p-4 bg-primary bg-opacity-10 rounded text-center">
                            <i class="bi bi-brain display-6 text-primary"></i>
                            <h6 class="mt-3">Goal Matching</h6>
                            <p class="small text-muted">AI-powered contact suggestions based on your goals</p>
                            <a href="/goal-matcher" class="btn btn-primary btn-sm">Start Matching</a>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="p-4 bg-success bg-opacity-10 rounded text-center">
                            <i class="bi bi-search display-6 text-success"></i>
                            <h6 class="mt-3">Contact Discovery</h6>
                            <p class="small text-muted">Discover unknown contacts and networking opportunities</p>
                            <a href="/intelligence/contact-discovery" class="btn btn-success btn-sm">Discover</a>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="p-4 bg-info bg-opacity-10 rounded text-center">
                            <i class="bi bi-shield-check display-6 text-info"></i>
                            <h6 class="mt-3">Trust Insights</h6>
                            <p class="small text-muted">Analyze relationship trust and contribution scores</p>
                            <a href="/intelligence/trust-insights" class="btn btn-info btn-sm">View Insights</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Tab -->
        <div class="tab-pane fade" id="network" role="tabpanel">
            <div class="glass-card p-4">
                <h5 class="mb-4">Network Visualization & Analytics</h5>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="p-4 bg-dark bg-opacity-25 rounded">
                            <h6 class="mb-3">Network Stats</h6>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="h5 text-primary">{{ stats.total_contacts or 0 }}</div>
                                    <div class="small text-muted">Contacts</div>
                                </div>
                                <div class="col-4">
                                    <div class="h5 text-success">0</div>
                                    <div class="small text-muted">Connections</div>
                                </div>
                                <div class="col-4">
                                    <div class="h5 text-warning">0%</div>
                                    <div class="small text-muted">Density</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-4">
                        <div class="p-4 bg-dark bg-opacity-25 rounded">
                            <h6 class="mb-3">Quick Actions</h6>
                            <div class="d-grid gap-2">
                                <a href="/network-visualization" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-diagram-3"></i> View Network Map
                                </a>
                                <a href="/analytics" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-graph-up"></i> Analytics Dashboard
                                </a>
                                <a href="/intelligence/smart-networking" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-lightning"></i> Smart Networking
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Footer -->
    {% if user_profile %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="glass-card p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <div class="small fw-medium">{{ user_profile.title or 'Contact Seeker' }}</div>
                            <div class="small text-muted">{{ user_profile.xp or 0 }} XP</div>
                        </div>
                        {% if user_profile.streak_count %}
                        <div class="small">
                            <i class="bi bi-fire text-warning"></i> {{ user_profile.streak_count }} day streak
                        </div>
                        {% endif %}
                    </div>
                    <div class="d-flex gap-2">
                        <a href="/settings" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                        <a href="/logout" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-box-arrow-right"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Quick Action Modals -->
<div class="modal fade" id="quickActionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title" id="quickActionTitle">Quick Action</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="quickActionBody">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>
</div>

<style>
.glass-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.nav-pills .nav-link {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
    margin: 0 2px;
}

.nav-pills .nav-link.active {
    background: rgba(59, 130, 246, 0.2);
    border-color: rgba(59, 130, 246, 0.3);
    color: #3b82f6;
}

.nav-pills .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.space-y-3 > * + * {
    margin-top: 0.75rem;
}

.tab-pane {
    min-height: 400px;
}
</style>

<script>
function showQuickAction(type) {
    const modal = new bootstrap.Modal(document.getElementById('quickActionModal'));
    const title = document.getElementById('quickActionTitle');
    const body = document.getElementById('quickActionBody');
    
    if (type === 'goal') {
        title.textContent = 'Quick Goal Creation';
        body.innerHTML = `
            <form action="/goals" method="POST">
                <div class="mb-3">
                    <label for="goalDescription" class="form-label">Goal Description</label>
                    <textarea class="form-control" id="goalDescription" name="description" rows="3" 
                              placeholder="Describe what you want to achieve..." required></textarea>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Create Goal</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        `;
    } else if (type === 'contact') {
        title.textContent = 'Quick Contact Addition';
        body.innerHTML = `
            <form action="/contacts" method="POST">
                <div class="mb-3">
                    <label for="contactName" class="form-label">Name</label>
                    <input type="text" class="form-control" id="contactName" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="contactEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="contactEmail" name="email">
                </div>
                <div class="mb-3">
                    <label for="contactCompany" class="form-label">Company</label>
                    <input type="text" class="form-control" id="contactCompany" name="company">
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Add Contact</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        `;
    }
    
    modal.show();
}

// Initialize Bootstrap tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="glass-card p-3 text-center">
                <div class="h4 text-primary mb-1">{{ stats.total_goals or 0 }}</div>
                <div class="small text-muted">Goals</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="glass-card p-3 text-center">
                <div class="h4 text-success mb-1">{{ stats.total_contacts or 0 }}</div>
                <div class="small text-muted">Contacts</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="glass-card p-3 text-center">
                <div class="h4 text-warning mb-1">{{ stats.pending_follow_ups or 0 }}</div>
                <div class="small text-muted">Follow-ups Due</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="glass-card p-3 text-center">
                <div class="h4 text-info mb-1">{{ stats.this_month_interactions or 0 }}</div>
                <div class="small text-muted">This Month</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Goals Column -->
        <div class="col-lg-6 mb-4">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Recent Goals</h5>
                    <a href="/goals" class="btn btn-outline-primary btn-sm">View All</a>
                </div>
                
                {% if goals and goals|length > 0 %}
                    <div class="space-y-3">
                        {% for goal in goals[:5] %}
                        <div class="p-3 bg-dark bg-opacity-25 rounded">
                            <div class="fw-medium">{{ goal.description[:80] }}{% if goal.description|length > 80 %}...{% endif %}</div>
                            <div class="small text-muted mt-1">
                                <i class="bi bi-calendar"></i> {{ goal.created_at.strftime('%b %d') if goal.created_at else 'Recent' }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-target display-4 text-muted"></i>
                        <p class="mt-3 mb-0">No goals yet</p>
                        <p class="small text-muted">Create your first goal to get started</p>
                        <a href="/goals/create" class="btn btn-primary btn-sm mt-2">Create Goal</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Contacts Column -->
        <div class="col-lg-6 mb-4">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Recent Contacts</h5>
                    <a href="/contacts" class="btn btn-outline-primary btn-sm">View All</a>
                </div>
                
                {% if contacts and contacts|length > 0 %}
                    <div class="space-y-3">
                        {% for contact in contacts[:6] %}
                        <div class="d-flex align-items-center p-2 bg-dark bg-opacity-25 rounded">
                            <div class="flex-grow-1">
                                <div class="fw-medium">{{ contact.name }}</div>
                                <div class="small text-muted">
                                    {% if contact.company %}{{ contact.company }}{% endif %}
                                    {% if contact.title %}· {{ contact.title }}{% endif %}
                                </div>
                            </div>
                            <div class="small text-muted">
                                {% if contact.warmth %}
                                    <span class="badge bg-{{ 'success' if contact.warmth == 'warm' else 'warning' if contact.warmth == 'cool' else 'secondary' }}">
                                        {{ contact.warmth.title() }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-people display-4 text-muted"></i>
                        <p class="mt-3 mb-0">No contacts yet</p>
                        <p class="small text-muted">Add your first contact to build your network</p>
                        <a href="/contacts/create" class="btn btn-primary btn-sm mt-2">Add Contact</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- AI Suggestions Section -->
    {% if ai_suggestions and ai_suggestions|length > 0 %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">AI Suggestions</h5>
                    <a href="/ai-suggestions" class="btn btn-outline-primary btn-sm">View All</a>
                </div>
                
                <div class="row">
                    {% for suggestion in ai_suggestions[:3] %}
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-dark bg-opacity-25 rounded">
                            <div class="small text-primary mb-2">{{ suggestion.suggestion_type.replace('_', ' ').title() }}</div>
                            <div class="fw-medium small">{{ suggestion.content[:100] }}{% if suggestion.content|length > 100 %}...{% endif %}</div>
                            {% if suggestion.confidence_score %}
                            <div class="mt-2">
                                <div class="small text-muted">Confidence: {{ "%.0f" | format(suggestion.confidence_score * 100) }}%</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- User Profile/Gamification -->
    {% if user_profile %}
    <div class="row">
        <div class="col-12">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">{{ user_profile.title or 'Contact Seeker' }}</h6>
                        <div class="small text-muted">{{ user_profile.xp or 0 }} XP</div>
                    </div>
                    <div class="text-end">
                        {% if user_profile.streak_count %}
                        <div class="small">
                            <i class="bi bi-fire text-warning"></i> {{ user_profile.streak_count }} day streak
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.glass-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.space-y-3 > * + * {
    margin-top: 0.75rem;
}
</style>