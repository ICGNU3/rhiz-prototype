<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration & Automation - Founder Network AI</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .integration-card {
            transition: transform 0.2s ease-in-out;
        }
        .integration-card:hover {
            transform: translateY(-2px);
        }
        .status-badge {
            font-size: 0.8rem;
        }
        .config-section {
            background: var(--bs-gray-900);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .automation-log {
            max-height: 300px;
            overflow-y: auto;
            background: var(--bs-gray-900);
            border-radius: 4px;
            padding: 1rem;
        }
    </style>
</head>
<body>
    {% include 'navigation.html' %}
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-5 mb-3">
                    <i class="bi bi-gear-fill text-warning me-3"></i>
                    Integration & Automation
                </h1>
                <p class="lead text-muted">
                    Connect your networking workflow with external tools and automate routine tasks
                </p>
            </div>
        </div>

        <!-- Integration Status Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card integration-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">
                                    <i class="bi bi-slack text-info me-2"></i>Slack
                                </h5>
                                <p class="card-text small text-muted">Team notifications</p>
                            </div>
                            <span class="badge bg-{{ 'success' if integration_status.slack.configured else 'warning' }} status-badge">
                                {{ integration_status.slack.status }}
                            </span>
                        </div>
                        {% if integration_status.slack.configured %}
                            <button class="btn btn-sm btn-success" onclick="testSlackIntegration()">
                                <i class="bi bi-check-circle"></i> Test Connection
                            </button>
                        {% else %}
                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#slackConfigModal">
                                <i class="bi bi-gear"></i> Configure
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card integration-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">
                                    <i class="bi bi-telegram text-info me-2"></i>Telegram
                                </h5>
                                <p class="card-text small text-muted">Bot notifications</p>
                            </div>
                            <span class="badge bg-{{ 'success' if integration_status.telegram.configured else 'warning' }} status-badge">
                                {{ integration_status.telegram.status }}
                            </span>
                        </div>
                        {% if integration_status.telegram.configured %}
                            <button class="btn btn-sm btn-success" onclick="testTelegramIntegration()">
                                <i class="bi bi-check-circle"></i> Test Bot
                            </button>
                        {% else %}
                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#telegramConfigModal">
                                <i class="bi bi-gear"></i> Configure
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card integration-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">
                                    <i class="bi bi-calendar-check text-primary me-2"></i>Calendar
                                </h5>
                                <p class="card-text small text-muted">Meeting automation</p>
                            </div>
                            <span class="badge bg-{{ 'success' if integration_status.calendar.configured else 'secondary' }} status-badge">
                                {{ integration_status.calendar.status }}
                            </span>
                        </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="scheduleFollowUp()">
                            <i class="bi bi-plus-circle"></i> Schedule Follow-up
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card integration-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">
                                    <i class="bi bi-database text-success me-2"></i>CRM Sync
                                </h5>
                                <p class="card-text small text-muted">Export contacts</p>
                            </div>
                            <span class="badge bg-success status-badge">
                                {{ integration_status.crm_sync.status }}
                            </span>
                        </div>
                        <button class="btn btn-sm btn-success" onclick="exportContacts()">
                            <i class="bi bi-download"></i> Export CSV
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card integration-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title">
                                    <i class="bi bi-twitter text-info me-2"></i>Social Media
                                </h5>
                                <p class="card-text small text-muted">Contact monitoring</p>
                            </div>
                            <span class="badge bg-secondary status-badge">
                                {{ integration_status.social_monitoring.status }}
                            </span>
                        </div>
                        <button class="btn btn-sm btn-outline-info" onclick="checkSocialUpdates()">
                            <i class="bi bi-search"></i> Check Updates
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Automation Controls -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="config-section">
                    <h4 class="mb-3">
                        <i class="bi bi-robot text-warning me-2"></i>Automation Controls
                    </h4>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoSlackNotifications" checked>
                                <label class="form-check-label" for="autoSlackNotifications">
                                    Slack notifications for interactions
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoFollowUpReminders" checked>
                                <label class="form-check-label" for="autoFollowUpReminders">
                                    Automatic follow-up reminders
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="dailyDigest" checked>
                                <label class="form-check-label" for="dailyDigest">
                                    Daily networking digest
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="socialMonitoring">
                                <label class="form-check-label" for="socialMonitoring">
                                    Social media monitoring
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button class="btn btn-primary me-2" onclick="runDailyAutomation()">
                            <i class="bi bi-play-circle"></i> Run Daily Automation
                        </button>
                        <button class="btn btn-outline-secondary" onclick="testAllIntegrations()">
                            <i class="bi bi-gear"></i> Test All Integrations
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="config-section">
                    <h5 class="mb-3">Quick Actions</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="sendTestSlackMessage()">
                            <i class="bi bi-slack"></i> Send Test Slack Message
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="exportToHubSpot()">
                            <i class="bi bi-database"></i> Export to HubSpot Format
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="checkFollowUps()">
                            <i class="bi bi-calendar-check"></i> Check Follow-ups Due
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="viewSocialUpdates()">
                            <i class="bi bi-twitter"></i> View Social Updates
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="row">
            <div class="col-12">
                <div class="config-section">
                    <h4 class="mb-3">
                        <i class="bi bi-clock-history text-info me-2"></i>Automation Activity Log
                    </h4>
                    <div class="automation-log" id="automationLog">
                        <div class="text-muted">
                            <i class="bi bi-info-circle me-2"></i>
                            Activity log will appear here after automation runs...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slack Configuration Modal -->
    <div class="modal fade" id="slackConfigModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-slack text-info me-2"></i>Configure Slack Integration
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">
                        To enable Slack notifications, you need to provide your Slack Bot Token and Channel ID.
                    </p>
                    
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle me-2"></i>Setup Instructions:</h6>
                        <ol class="mb-0">
                            <li>Go to <a href="https://api.slack.com/apps" target="_blank">Slack Apps</a></li>
                            <li>Create a new app or select existing</li>
                            <li>Go to OAuth & Permissions</li>
                            <li>Add these scopes: <code>chat:write</code>, <code>channels:read</code></li>
                            <li>Install app to workspace</li>
                            <li>Copy Bot User OAuth Token</li>
                        </ol>
                    </div>

                    <form id="slackConfigForm">
                        <div class="mb-3">
                            <label for="slackToken" class="form-label">Slack Bot Token</label>
                            <input type="password" class="form-control" id="slackToken" placeholder="xoxb-your-token-here">
                        </div>
                        <div class="mb-3">
                            <label for="slackChannel" class="form-label">Channel ID</label>
                            <input type="text" class="form-control" id="slackChannel" placeholder="C1234567890">
                            <div class="form-text">Right-click channel → View channel details → Copy Channel ID</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSlackConfig()">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Configuration Modal -->
    <div class="modal fade" id="telegramConfigModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-telegram text-info me-2"></i>Configure Telegram Bot
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">
                        Set up a Telegram bot to receive networking updates, daily digests, and interactive commands.
                    </p>
                    
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle me-2"></i>Setup Instructions:</h6>
                        <ol class="mb-0">
                            <li>Message <a href="https://t.me/BotFather" target="_blank">@BotFather</a> on Telegram</li>
                            <li>Send <code>/newbot</code> and follow instructions</li>
                            <li>Choose name: "Your Network AI Bot"</li>
                            <li>Choose username: "yourname_network_bot"</li>
                            <li>Copy the bot token provided</li>
                            <li>Start a chat with your bot and send <code>/start</code></li>
                            <li>Get your Chat ID from <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a></li>
                        </ol>
                    </div>

                    <div class="alert alert-warning">
                        <h6><i class="bi bi-lightning me-2"></i>Bot Features:</h6>
                        <ul class="mb-0">
                            <li><strong>/stats</strong> - View networking metrics</li>
                            <li><strong>/contacts</strong> - List recent contacts</li>
                            <li><strong>/followups</strong> - Check what's due</li>
                            <li><strong>/digest</strong> - Get daily summary</li>
                            <li><strong>/export</strong> - Download contacts CSV</li>
                            <li><strong>Natural language</strong> - "Show warm contacts"</li>
                        </ul>
                    </div>

                    <form id="telegramConfigForm">
                        <div class="mb-3">
                            <label for="telegramToken" class="form-label">Bot Token</label>
                            <input type="password" class="form-control" id="telegramToken" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                        </div>
                        <div class="mb-3">
                            <label for="telegramChatId" class="form-label">Your Chat ID</label>
                            <input type="text" class="form-control" id="telegramChatId" placeholder="123456789">
                            <div class="form-text">Message @userinfobot to get your Chat ID</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTelegramConfig()">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Integration functions
        function testSlackIntegration() {
            fetch('/integrations/slack/test', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        logActivity('✅ Slack integration test successful');
                        showAlert('Slack test message sent successfully!', 'success');
                    } else {
                        logActivity('❌ Slack integration test failed: ' + data.error);
                        showAlert('Slack test failed: ' + data.error, 'danger');
                    }
                });
        }

        function scheduleFollowUp() {
            // This would open a contact selector modal
            const contactName = prompt('Enter contact name for follow-up:');
            if (contactName) {
                const days = prompt('Days ahead (default 7):', '7');
                const note = prompt('Follow-up note:', 'Follow up on previous conversation');
                
                fetch('/integrations/calendar/schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contact_name: contactName, days_ahead: parseInt(days) || 7, note: note })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        logActivity(`📅 Follow-up scheduled for ${contactName}`);
                        showAlert(data.message, 'success');
                    } else {
                        logActivity(`❌ Failed to schedule follow-up: ${data.error}`);
                        showAlert('Failed to schedule follow-up: ' + data.error, 'danger');
                    }
                });
            }
        }

        function exportContacts() {
            logActivity('📤 Exporting contacts to CSV...');
            window.location.href = '/integrations/export/csv';
        }

        function checkSocialUpdates() {
            logActivity('🔍 Checking social media updates...');
            fetch('/integrations/social/updates')
                .then(response => response.json())
                .then(data => {
                    logActivity(`📱 Found ${data.updates.length} social updates`);
                    if (data.updates.length > 0) {
                        showAlert(`Found ${data.updates.length} new social updates`, 'info');
                    } else {
                        showAlert('No new social updates found', 'info');
                    }
                });
        }

        function runDailyAutomation() {
            logActivity('🤖 Running daily automation...');
            fetch('/integrations/automation/daily', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    logActivity('✅ Daily automation completed');
                    showAlert('Daily automation completed successfully', 'success');
                });
        }

        function testAllIntegrations() {
            logActivity('🧪 Testing all integrations...');
            fetch('/integrations/test/all', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    logActivity('✅ Integration tests completed');
                    showAlert('Integration tests completed', 'info');
                });
        }

        function sendTestSlackMessage() {
            testSlackIntegration();
        }

        function exportToHubSpot() {
            logActivity('📤 Exporting in HubSpot format...');
            window.location.href = '/integrations/export/hubspot';
        }

        function checkFollowUps() {
            logActivity('📋 Checking follow-ups due...');
            fetch('/integrations/followups/check')
                .then(response => response.json())
                .then(data => {
                    logActivity(`📋 ${data.count} follow-ups due`);
                    showAlert(`${data.count} follow-ups due`, 'info');
                });
        }

        function viewSocialUpdates() {
            checkSocialUpdates();
        }

        function saveSlackConfig() {
            const token = document.getElementById('slackToken').value;
            const channel = document.getElementById('slackChannel').value;
            
            if (!token || !channel) {
                showAlert('Please fill in both token and channel ID', 'warning');
                return;
            }
            
            // This would save to environment variables or user settings
            showAlert('Slack configuration would be saved (requires environment variable setup)', 'info');
            bootstrap.Modal.getInstance(document.getElementById('slackConfigModal')).hide();
        }

        // Utility functions
        function logActivity(message) {
            const log = document.getElementById('automationLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'mb-1';
            entry.innerHTML = `<small class="text-muted">${timestamp}</small> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function showAlert(message, type) {
            // Create and show Bootstrap alert
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.container-fluid').prepend(alertDiv);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logActivity('🚀 Integration dashboard loaded');
        });
    </script>
</body>
</html>